\subsection{Projection of monomer orbitals on dimer orbitals (DIPRO)}
\label{sec:dipro}
An approach for the determination of the transfer integral that can be used for 
any single-particle electronic structure method (Hartree-Fock, DFT, or 
semiempirical methods) is based on the projection of monomer orbitals on a 
manifold of explicitly calculated dimer orbitals. This dimer projection (DIPRO) 
technique including an assessment of computational parameters such as the basis 
set, exchange-correlation functionals, and convergence criteria is presented in 
detail in ref.~\cite{baumeier_density-functional_2010}. A brief summary of the 
concept is given below.

We start from an effective Hamiltonian~\footnote{we use following notations: $a$ 
- number, $\veca$ - vector, $\matr{A}$ - matrix, $\oper{A}$ - operator}
%
\begin{equation}
  \oper{H}^\text{eff} = \sum_i \epsilon_i \oper{a}_i^\dagger \oper{a}_i + 
\sum_{j \neq i} J_{ij} \oper{a}_i^\dagger \oper{a}_j + c.c.
  \label{equ:dipro_eq1}
\end{equation}
%
where $\oper{a}_i^\dagger$ and $\oper{a}_i$ are the creation and annihilation 
operators for a charge carrier located at the molecular site $i$.
The electron site energy is given by $\epsilon_i$, while $J_{ij}$  is the 
transfer integral between two sites $i$ and $j$. We label their frontier 
orbitals (HOMO for hole transfer, LUMO for electron transfer) $\phi_i$ and 
$\phi_j$, respectively. Assuming that the frontier orbitals of a dimer 
(adiabatic energy surfaces) result exclusively from the interaction of the 
frontier orbitals of monomers, and consequently expand them in terms of $\phi_i$ 
and $\phi_j$. The expansion coefficients, $\vect{C}$, can be determined by 
solving the secular equation
%
\begin{equation}
  (\matr{H} - E \matr{S})\vect{C} = 0
  \label{equ:dipro_eq2}
\end{equation}
%
where $\matr{H}$ and $\matr{S}$ are the Hamiltonian and overlap matrices of the 
system, respectively. 
%
%Since it is easier to work in matrix form, the following
%equation also holds (equation (\ref{eq:dipro_eq2}) in matrix form):
%
%\begin{equation}
% \matr{H}\matr{U} = \matr{S}\matr{U}\matr{E}
%  \label{eq:dipro_eq3}
% \end{equation}
%
These matrices can be written explicitly as
%
\begin{equation}
% \begin{aligned}
  \matr{H} = 
  \begin{pmatrix}
    e_i    &  H_{ij} \\
    H_{ij}^* &  e_j  
  \end{pmatrix} \hspace{2cm}
  \matr{S} = 
  \begin{pmatrix}
    1    &  S_{ij} \\
    S_{ij}^* &  1  
  \end{pmatrix}
%  \end{aligned}
  \label{equ:dipro_eq3}
\end{equation}
%
with 
%
\begin{equation}
 \begin{aligned}
  e_i &= \bra{\phi_i}\oper{H} \ket{\phi_i} \hspace{2cm}  H_{ij} = 
\bra{\phi_i}\oper{H} \ket{\phi_j}\\
  e_j &= \bra{\phi_j}\oper{H} \ket{\phi_j} \hspace{2cm}  S_{ij} = \bra{\phi_j} 
\phi_j\rangle %S 
 \end{aligned}
  \label{equ:dipro_eq4}
\end{equation}
The matrix elements $e_{i(j)}$, $H_{ij}$, and $S_{ij}$ entering \equ{dipro_eq3} 
can be calculated via projections on the dimer orbitals (eigenfunctions of 
$\hat{H}$) $\left\{\ket{\phi^\text{D}_n}\right\}$ by inserting $\oper{1} = 
\sum_n \ket{\phi^\text{D}_n}\bra{\phi^\text{D}_n}$ twice. We exemplify this 
explicitly for $H_{ij}$ in the following
%
\begin{equation}
  H_{ij} = \sum_{nm}{\braket{\phi_i}{\phi^\text{D}_n} 
\bra{\phi^{D}_n}\hat{H}\ket{\phi^\text{D}_m}\braket{\phi^\text{D}_m}{\phi_j}} .
  \label{eq:dipro_eq16}
\end{equation}
%
The Hamiltonian is diagonal in its eigenfunctions, 
$\bra{\phi^\text{D}_n}\oper{H}\ket{\phi^\text{D}_m} = E_n \delta_{nm}$. 
Collecting the projections of the frontier orbitals  $\ket{\phi_{i(j)}}$ on the 
$n$-th dimer state $\left(\vect{V}_{(i)}\right)_n= 
\braket{\phi_i}{\phi^\text{D}_n}$ and 
$\left(\vect{V}_{(j)}\right)_n=\braket{\phi_j}{\phi^\text{D}_n}$ respectively, 
into vectors we obtain

\begin{equation}
   H_{ij} = \vect{V}_{(i)} \matr{E}   \vect{V}_{(j)}^\dagger .
  \label{eq:dipro_eq17}
\end{equation}
%
What is left to do is determine these projections $\vect{V}_{(k)}$. In all 
practical calculations the molecular orbitals are expanded in basis sets of 
either plane waves or of localized atomic orbitals $\ket{\varphi_\alpha}$. We 
will first consider the case that the calculations for
the monomers are performed using a counterpoise basis set that is commonly used 
to deal with the basis set superposition error (BSSE). The basis set of 
atom-centered orbitals of a monomer is extended to the one of the dimer by 
adding the respective atomic orbitals at virtual coordinates of the second 
monomer. We can then write the respective expansions as

\begin{equation}
 %\begin{aligned}
  \ket{\phi_{k}} = \sum_{\alpha} \lambda^{(k)}_\alpha \ket{\varphi_\alpha} 
\hspace{1cm}\text{and}\hspace{1cm}
  \ket{\phi^\text{D}_n} = \sum_{\alpha} D^{(n)}_\alpha \ket{\varphi_\alpha}
  \label{eq:dipro_eq18}
\end{equation}
%
where $k=i,j$. The projections can then be determined within this common basis 
set as

 \begin{equation}
  \begin{aligned}
     \left(\vect{V}_k\right)_n=\braket{\phi_k}{\phi^\text{D}_n} = \sum_{\alpha} 
\lambda^{(k)}_{\alpha} \bra{\alpha} \sum_{\beta} D^{(n)}_{\beta} \ket{\beta} = 
     \vect{\boldsymbol{\lambda}}_{(k)}^\dagger \matr{\mathcal{S}} 
\vect{D}_{(n)} 
%     %\\
% %    \braket{B|i} = \sum_{\alpha} B_{\alpha} \bra{\alpha}
% %    \sum_{\beta} D^{(i)}_{\beta} \ket{\beta} = 
% %    \vect{B}^\dagger \matr{S} \vect{D}^{(i)} \\
  \end{aligned}
   \label{eq:dipro_eq19}
 \end{equation}
where $\matr{\mathcal{S}}$ is the overlap matrix of the atomic basis functions. 
This allows us to finally write the elements of the Hamiltonian and overlap 
matrices in \equ{dipro_eq3} as:

 \begin{equation}
  \begin{aligned}
     H_{ij} &= \vect{\boldsymbol{\lambda}}_{(i)}^\dagger \matr{\mathcal{S}} 
\matr{D} \matr{E} \matr{D}^\dagger \matr{\mathcal{S}}^\dagger 
\vect{\boldsymbol{\lambda}}_{(j)}  \\
     S_{ij} &= \vect{\boldsymbol{\lambda}}_{(i)}^\dagger \matr{\mathcal{S}} 
\matr{D}  \matr{D}^\dagger \matr{\mathcal{S}}^\dagger 
\vect{\boldsymbol{\lambda}}_{(j)} 
  \end{aligned}
   \label{eq:dipro_eq20}
 \end{equation}
%
Since the two monomer frontier orbitals that form the basis of this expansion 
are not orthogonal in general ($\matr{S} \neq \matr{1}$), it is necessary to 
transform \equ{dipro_eq2} into a standard eigenvalue problem of the form
%
\begin{equation}
  \matr{H}^{\mathrm{eff}} \vect{C}^{\mathrm{eff}} =   E \vect{C}^{\mathrm{eff}} 
  \label{eq:dipro_eq7}
\end{equation}
%
to make it correspond to \equ{dipro_eq1}. According to L\"owdin such a 
transformation can be achieved by
%
\begin{equation}
  \matr{H^\mathrm{eff}} = \matr{S}^{\left. {-1} \middle/ {2} \right.}
  \matr{H}\matr{S}^{\left. {-1} \middle/ {2} \right.}.
  \label{eq:dipro_eq9}
\end{equation}
%
This then yields an effective Hamiltonian matrix in an orthogonal basis, and its 
entries can directly be identified with the site energies $\epsilon_i$ and 
transfer integrals $J_{ij}$:
%
\begin{equation}
 \begin{aligned}
  \matr{H}^{\mathrm{eff}} &= 
    \begin{pmatrix}
      e_i^{\mathrm{eff}}    &  H_{ij}^\mathrm{eff} \\
      H_{ij}^{*,\mathrm{eff}}   &  e_j^\mathrm{eff}  
    \end{pmatrix} =
    \begin{pmatrix}
      \epsilon_i    &  J_{ij} \\
      J_{ij}^*      &  \epsilon_j  
    \end{pmatrix} 
 \end{aligned}
  \label{eq:dipro_eq11}
\end{equation}

 \begin{figure}[htb]
     \center
     \includegraphics[width=\linewidth]{fig/idft_flow/schemes_all}
     \caption{Schematics of the DIPRO method. (a) General workflow of the 
projection technique. (b) Strategy of the efficient noCP+noSCF implementation, 
in which the monomer calculations are performed independently form the dimer 
configurations (noCP), using the \calc{edft} \calculator. The dimer Hamiltonian 
is subsequently constructed based on an initial guess formed from monomer 
orbitals and only diagonalized once (noSCF) before the transfer integral is 
calculated by projection. This second step is performed by the \calc{idft} 
\calculator. }
     \label{fig:dipro_scheme}
 \end{figure}

